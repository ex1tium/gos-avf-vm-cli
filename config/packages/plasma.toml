# KDE Plasma Desktop Configuration
# Full KDE Plasma desktop environment for desktop-style operation.
# This is the traditional Plasma desktop, not the mobile version.

[meta]
name = "plasma"
display_name = "KDE Plasma"
description = "Full KDE Plasma desktop environment"
type = "desktop"

[packages]
core = [
    "plasma-desktop",
    "plasma-workspace",
    "sddm",  # Display manager (disabled by gvm)
    "konsole",
    "dolphin",
]
optional = [
    "firefox-esr",
    "kate",
    "kscreen",
    "plasma-nm",  # Network manager applet
    "kde-spectacle",  # Screenshot tool
]
wayland_helpers = [
    "plasma-workspace-wayland",
    "xwayland",
]
user_packages = []

[environment]
# Note: WAYLAND_DISPLAY is intentionally omitted - the compositor sets it dynamically at runtime
vars = [
    "XDG_SESSION_TYPE=wayland",
    "QT_QPA_PLATFORM=wayland",
    "QT_WAYLAND_DISABLE_WINDOWDECORATION=1",
    "GDK_BACKEND=wayland",
    "MOZ_ENABLE_WAYLAND=1",
    "SDL_VIDEODRIVER=wayland",
    "CLUTTER_BACKEND=wayland",
    "WLR_NO_HARDWARE_CURSORS=1",
    "LIBGL_ALWAYS_INDIRECT=0",
]

[files]
"~/.config/plasma-workspace/env/linuxvm-wayland.sh" = """#!/bin/sh
# Environment setup for KDE Plasma on GrapheneOS VM
# Generated by GVM setup tool

export XDG_SESSION_TYPE=wayland
export QT_QPA_PLATFORM=wayland
export MOZ_ENABLE_WAYLAND=1
export GDK_BACKEND=wayland
export SDL_VIDEODRIVER=wayland
export WLR_NO_HARDWARE_CURSORS=1

# Ensure D-Bus session is available
if [ -z "$DBUS_SESSION_BUS_ADDRESS" ]; then
    eval $(dbus-launch --sh-syntax)
fi
"""

[session]
start_command = "startplasma-wayland"
fallback_command = "kwin_wayland --xwayland --exit-with-session plasmashell"
requires_dbus_session = true
helper_script_name = "start-plasma"

[conflicts]
# No hard conflicts with other desktops, but warn about disk usage
desktops = []
packages = []
